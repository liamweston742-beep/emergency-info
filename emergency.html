<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Emergency Information</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

<style>
  body {
    font-family: 'Roboto', Arial, sans-serif;
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    background: linear-gradient(135deg, #e0e5ec, #f5f7fa);
    min-height: 100vh;
  }

  .container {
    background: #fff;
    width: 95%;
    max-width: 480px;
    padding: 30px;
    border-radius: 16px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    border: 1px solid #d1d5db;
  }

  h1 { text-align: center; color: #b30000; margin-bottom: 5px; }
  .subtitle { text-align: center; color: #555; font-size: 0.9em; margin-bottom: 20px; }

  .input-wrapper {
    position: relative;
    width: 100%;
    margin-top: 10px;
  }

  .input-wrapper input {
    width: 100%;
    padding: 14px;
    padding-right: 50px;
    font-size: 1em;
    border-radius: 8px;
    border: 1px solid #b0b5bf;
    box-sizing: border-box;
    transition: border-color 0.3s, box-shadow 0.3s;
  }

  .input-wrapper input:focus {
    outline: none;
    border-color: #0052cc;
    box-shadow: 0 0 5px rgba(0,82,204,0.3);
  }

  .input-wrapper .show-hide {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    border: none;
    background: none;
    cursor: pointer;
    font-size: 1.1em;
    color: #555;
  }

  .input-wrapper .show-hide:hover { color: #000; }

  #unlockBtn {
    background-color: #b30000;
    color: white;
    margin-top: 15px;
    font-weight: 600;
    border-radius: 8px;
    border: none;
    padding: 14px;
    font-size: 1.05em;
    cursor: pointer;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
  }

  #unlockBtn:hover {
    background-color: #900000;
    box-shadow: 0 6px 12px rgba(0,0,0,0.15);
  }

  #error { color: #d93025; margin-top: 10px; font-weight: bold; text-align: center; }

  .card {
    background: #f9f9f9;
    padding: 20px;
    margin-top: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  }

  .card p { margin: 8px 0; line-height: 1.4; }
  .card strong { display: inline-block; width: 140px; }
  .hidden { display: none; }
</style>
</head>

<body>
<div class="container">
  <h1>Emergency Information</h1>
  <p class="subtitle">Authorised access only</p>

  <div class="input-wrapper">
    <input type="password" id="passphrase" placeholder="Enter passphrase">
    <button type="button" class="show-hide" onclick="togglePassphrase()">üëÅ</button>
  </div>

  <button id="unlockBtn" onclick="unlock()">Unlock</button>
  <p id="error"></p>

  <div id="info" class="hidden card">
    <p><strong>Name:</strong> <span id="name"></span></p>
    <p><strong>Nationality:</strong> <span id="nationality"></span></p>
    <p><strong>Allergies:</strong> <span id="allergies"></span></p>
    <p><strong>Medical Conditions:</strong> <span id="medical"></span></p>
    <p><strong>Medications:</strong> <span id="medications"></span></p>
    <p><strong>Blood Type:</strong> <span id="blood"></span></p>
    <p><strong>Emergency Contact 1:</strong> <span id="contact"></span></p>
    <p><strong>Emergency Contact 2:</strong> <span id="contact2"></span></p>
    <p><strong>Languages:</strong> <span id="languages"></span></p>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<script>
// All your encrypted records
const encryptedArray = [
[
  {
    "id": "a1b2c3d4",
    "iv": "58f2b7503ca1dcc523372b46098c2dce",
    "encryptedData": "aa412f172c1a7317df8499d149d394f49b40003d1612d0233e0591a9c23260bbd0692d4ea446f6259542c4856ecda9031c98484b9f3f7392a8b8247b2677eb7036fd6f505fe8b96fd25f51fd4627932e55c61232da14791172b8596b76d2a499093d657e9ecdc9e0bd6ce0130db734ceb35787cd441c0cc6a9ca44cb657b8fcd7b2914f463683038dfddd36a2d80f84c10fda8ffd6796a0068cd996b781523b183daf09d428d192bb1b690edf3ec0d1a421372da44b84f85514cced8f3a3777302cc480c7a1304b78543eb38e0ef9ff91693fc1e5284debb96d9c2eda6b1f1bdcb737ca2b9de5086fc9e04b164b78bd3f26dc2880814b5fb7bb216f509d68731f27644c6f290912d3b739e7cfa81a965f778aca74dfc9e66e0d888c7fd903536"
  },
  {
    "id": "e5f6g7h8",
    "iv": "1453eb4f548b7b90873f9d5ac235e1b9",
    "encryptedData": "e069ec0d70195d6a80cf571115b966451ff783ce21ab7fe559e32a6a6b1df995fc7d1ea2bbba73b89bc1e85119db0730b01d540480f076288135a22f2a4c826f43c004dd670f36c631892fbdd02a7226529b2de74c1d1b48d76ec65fae714ec2aafadfb7696e718b3a96edbf1d6f5501a74c756b12076f202e85afaec86323456e34ff4298ef258a703495d32f3229d90209cab2d67f88639039c2175bfe7a6241973245f9aaf37a4b8e78c291e82252ac8ba421c5dca58b5202f864e87e9b2ab1759b2c22f6193a563130c176ff700d7bfee4a02b7d6e8440fa72ea10ccf7e2da873f3b88e37f46a3e6dc315d8c3f5ee1ff60d0027cbda0b4b16d649eef42b3115ddcaf4f129766648fddf1cce2f983b92c7346da5baedb4dda273eac6b04f40a19eb4f4391745593c3d6160182ab95"
  },
  {
    "id": "i9j0k1l2",
    "iv": "274b5f1f1db96eccd86ca29eec18d3da",
    "encryptedData": "3a203c74d526fd62b122f04667927cacaa5241c1e9dd82905281a25de5c532bf03a2b0f842f9192455e9fa59ea7d18e7be732b78cfb867ae83ecb9ef8988929b31b429b191fb82db5ba0b39fe9a54275d0a8d237fe2219cf5d42ed9e9e79c5f4918933d72f525cac31aa6511f79c896b4a278386554b6b0b0ad76c38f75c6e2d73ed3fb0598ea262a37c040b43cdb3e7703a7584abce33457278f9c8fc6794f3f0697305f78dd24a4a83d8a3c3fb82d54ea3df2ead1ac7ea9e3cc607ca70a8632b293c8933d37bcb7de2119b1c831c7ba4cfd35ba65cd07a067d976c377b1cd148d5191c006b4c255c6be9ae4aa945f594aabd0f64dd85cba05a4705095b62b55a6cc2c1bdb9ee1dcc4ccc85b454164a3e055e7a3b7466f16f507ee5547d1f2d198b0358cf3ccb1eb2e2e3e64048850f"
  },
  {
    "id": "m3n4o5p6",
    "iv": "87380d7af15db8e9b3e4e95fb9fbd9d9",
    "encryptedData": "234d931c3be3a3dfe61f2dd5c46c06a2ca7b138029ac0e97873eeb2d74252e2496d306af4a802da55c69db9ea52d8fb0b24a1da102fcafb083037ace488f8c96484b8fd895f8b7feab8c3f29e12ddffab1e31f4f5a65ef5ecb1faec45da5db126b8801bfce3d25ea620de331587dc4d7511ca61a337163bc3a553d76d3164ec7e2718ef9399c77097eb08dd64eeb219cce5e3797339e9d18fcdc0381e281d3dc106ed0253c1c3c975c84b762fe81271cc1e09cfa1659e732d4d2b5f00680f4cc2473e409c1f759afd157821f486df569b375096161c52eed96509879ae321e3fe9797897784e8e45f213068511c075c6aee3b719e2d0293eeb8254a492a9cbfff060d11033e258c21c8ef33def8190e6"
  },
  {
    "id": "q7r8s9t0",
    "iv": "7ce27643b47985d5c553313631570ff1",
    "encryptedData": "2e6fc6033dd3f9df0a529a0a682f0b3553fe69636bc7a1de922e07fe4d67caab7fb3f71ad39ff9f40c5885ee5d30f67e93f9ac138e4d2480ffde4fd40a1d5cd120f1741fbdc3c134fb1b7c3f91b0ce304c4ab6a6600e6bdc48186c6eeb3a005d1fb7f8f157e3b715ba8201146860b183e1f14ea2eadf0e638f0f8654c6b04517045d0591a697f79b83c71698c359776aeb36e70f25e4e5bec5be6a7740f93fe41bce85d49457537407a4ee9049f4b0707042782b1a0264721ab7a8a7b2838f61b7b4bd55bee4634e023065271dea02b16270401c348264c9eba0b14ffe7c4cc390591cab197724bc61c5ba40d06ea0a4e12657d0c1bde99291db114e214016b8f30761ea0b497960c8af126b5d02fa405d63f760f64a793cd32d0971af228670"
  },
  {
    "id": "u1v2w3x4",
    "iv": "d888ba0674bb998aaf28443099a0890f",
    "encryptedData": "005c514b4d086728f78d98c555596bb7fd1b1a69eb9af533837dafa2b4652cc17531057cb21a2b2fcfe822536871dbc969b48366182398f5b08e53e729247c66a7389717f487c4930f3128d37a29a4665488ef44b4635fd96b5cf18cdba571301ca2036fc9966737d67981a8ffbb00722d716edffc3af3636c2897d5178e87c9b19170ca3ea62ccf35a8182bf93023fa87cf033700c1b174587f5318f644c5a337acfeac2b8fbfadf40553bf94a09758aa59b0daa2a80b527c9bcaad776b51cdfbd728b6b0b676149e3a76a94cf59d8652349f5f98280219e0a63421cc1dedc39696fda56d805197c48ceb1165fd34dffb4ec02d112346d2935c1e25c877731172bc46af3165dbf1daedf3fac437ba8aa596e5ab6e7e5f8e7bdb30e716177641"
  },
  {
    "id": "y5z6a7b8",
    "iv": "a01281d47e313980a4bd178eb829d46b",
    "encryptedData": "f9f9f7b0c0abfa277e052d7d2159af61abef579a1a91075dc600104a9b8cce3eacbf344247eb00c9259764c1f763c014c818c19363711a9c6d6a6882a471d05a1265bcd3e1cbd0bc3b7f6fc01f2a99166c77e5f6a02f94bc90828985969c349f32f7930de53020120e5cdd8d20399e9470a1b3a703ff840cec92234d70f188d7aea169d39b6c2fa5059318e3ea1549785706f9011d963ae7bcf189e4dcb61a604f402a2881c18b5fa1ed1dbe51cb159819623a0777f371f148dfc3a418203d7b24a05306ae0fa412f51488f9b268c8f38aae572ad40c54418f5dc168cc8c56fe9fcb5d9b5273eeb1e25c36f6cddf4e66bda74073a2c84d0e9a0bd6ef6836328669e37037182626688a22e5a8e685b755134f585c2572c1cd51e9ba901a90b242901f8a1d3552665ac7af763c17d28cda"
  },
  {
    "id": "c9d0e1f2",
    "iv": "51c62462c9b7aa7b1c6a172aa3f2df0a",
    "encryptedData": "13bcde98790353661709bdc416494729fd486f2d332ee706bb487b11d3c5742766ca9b2ee3687d76200a498480809615315f14361646f384879dca2651d417cce2ee7fc4ae42f0f5987022e803dbf7fe83d18bf7a142cdc4a4c39d74102c4e727cd27d25a43275f70f99ccc9b1df1c831fadabadc052bc53756c9a8fcc57b869a2d372a206497e1576c5a669a12af3dd5ba80d2c263fa36f71933f005b5fb6d4650d7bed34b93f13e010ce78eaba9181015f21fe1ef37d28df1d9fc39bd6a4c68585e59d00d39f06c77e6a021260d491d18e0304eb78f5462edcd1f0e2350be5d4f6f8e510f977a67ec7526365e5e2e5f22c90ab5cc377634d8a1daeac87c8ed005bb5f17473ee7caba3b2ad3c49d44c2b28350e3ddb22186b60c1b7f16f7eaa0a91bad0faba0e08442b1f9f6265ab5a5479f09c8cd881404a0ea48b16c4bd1e34d76a646538b51592405dace4d2d7ba"
  },
  {
    "id": "g3h4i5j6",
    "iv": "448d0e82a8f1fbce8282263a444f0137",
    "encryptedData": "49c99477d821ea945d34a818dfdfb88f34ea935002a2b3ea4f205ee329456f1eead71ffa771500f02334d10d620bdc65db377ef2469ee205d484e2570aff48350d0c200647f946957bb6b094f578770914f8247f0ad6e941f0de5d2c009d70534fd67d3554fd1e38e2eb26248d068e21307217006fd626197cc0e264e84a5a58a1d550f244bef62a2ccfa45240490eeadfbd0f997efb80fd9fc36d971e7b4796456cb53abc08452bc973be5c58dbd805e543b15f8225c3d62ee970a55db040da0bac5114419c79387c23e624a4d81b75707154968f2a28cb0c99b5dd0d8360eb7e3e80d564d3a54b4b7306ca4e18d05490f7efd5bbf50ac76bb7ed115db5d2d3a83a033065a920795d2a7623139309bb4cd160da54269d1cb2ec5b589dcf26be"
  },
  {
    "id": "k7l8m9n0",
    "iv": "d022f666fa987cf2a39b3732b7d821d9",
    "encryptedData": "0bb9be6695477d65451f04e510cf551a71a51bbeb32a7f412b26617386abccdb0e1fd2db335240b927f6ec5bea57c6c1ea20651aacfd392897e24b58503d33dd1bf1e54961f3434daaee556e71d21052e7befa589d4f7f248443abfe145a00846dee3767983cf82b0d8ec6249350548f956b17f5003de700199ad98b42ff6405bdc39cfc4254fa0762c9f8fba4eb6d7ebf3f9a002e21380b68edd2f2ffebdbf58aa183b0eeb642c1323e18b6268e041d8a8c831bc426393a60d573733cf98b1e85a7c63b37c42564db14f0981efbd2da115dc5d0d2a7572a708e6547322c110072777133dd29da93956b70099dc90c27eadb05fbae16de025b9ccaf9c7ca4953e9f2a38283cb38b80ded34051f6629ced286d6d7ef29356dca3e37b5addf2601"
  },
  {
    "id": "o1p2q3r4",
    "iv": "2aedbaff450f300f431a382a93f353ef",
    "encryptedData": "55a0a6e5aed477d8a629c32334af5f0290841bcf0e68bc61e991670f6cb6b2f1c1f2c7a35b8983038f5b9ca5be8867d569c002b46e05e4b9eb4f475a8e2c00b59d77f1f99aa5f36a6c66beefacef7f4e9057a1e407e78c1e9e4f30c817870af5752ece036be67e9b93793f862b8105e0b27b3593272761b6ebd03d07bfaf466d0ef5a6db34f571b50afc178a6c4577fdd2c880f89531132ab54a0e3a32b5f2008e51a57a0f2742cb684ff1b371ab4e84c1c7bbc16e05ec958bf2301ebedb94b38c61fa25a4daa4e47285874460cccd4c2ec3694b8bf66e1b496de24a9d51de36e0743725068c874957b8acd16c4d151cc5211cfd9a97a5bb037e32f164e0443daa01071f446642e505db31384bf6a0449f3aa2dbcdfebb6cfe7a43d91a46d300"
  },
  {
    "id": "s5t6u7v8",
    "iv": "54d189077d450159536bb584da7dd4dd",
    "encryptedData": "fc019a9dc4024cb2a3d2741cc6f8cbd3b97d29927be284719df07542d510741689d2dcaba61751e5b747a0c60250f13a93035368b21bd6271456e05fee0659005c1a85ca79f9ef520a8d2553333e890b473d839f43a7215a629058ad30eab797dc8618a7a00f01505c9dde698cd05b9e14d2f7345fa2b8de977a533f7d972184786d7a18456af201f14bfc549dc0592dff999149f7306e4f3d3a880bc3cc24e442bbdeebdd7eed176214be051fd2eac397ae84a583ae8d728076fe1ad0d638b9e49958d9cf924d29eee89f0d0c25ee99c00933fa32e14aca950a9616c8536b5ca7177bb85b68c868ea237ddc7f0f8fb79cdd9a6593fb39394bae9fb1ac9c82bb50bf114f3cd2103d8e11344eda997c1543108cab70260c4190281e2b690c8c5f"
  }
]

];


// Convert array to object correctly
const people = {};
encryptedArray[0].forEach(record => {
  people[record.id.toLowerCase()] = { encrypted: record.encryptedData, iv: record.iv };
});


// Get ID from URL
const params = new URLSearchParams(window.location.search);
const id = params.get("id")?.toLowerCase();

function togglePassphrase() {
  const input = document.getElementById("passphrase");
  input.type = input.type === "password" ? "text" : "password";
}

function deriveKey(passphrase) {
  return CryptoJS.SHA256(passphrase);
}

function decryptRecord(encryptedHex, ivHex, key) {
  const encryptedWords = CryptoJS.enc.Hex.parse(encryptedHex);
  const ivWords = CryptoJS.enc.Hex.parse(ivHex);
  const decrypted = CryptoJS.AES.decrypt(
    { ciphertext: encryptedWords },
    key,
    { iv: ivWords, mode: CryptoJS.mode.CBC, padding: CryptoJS.pad.Pkcs7 }
  );
  return decrypted.toString(CryptoJS.enc.Utf8);
}

function unlock() {
  const passphrase = document.getElementById("passphrase").value.trim();
  const error = document.getElementById("error");

  if (!passphrase) {
    error.textContent = "Enter a passphrase.";
    return;
  }

  if (!id || !people[id]) {
    error.textContent = "Invalid emergency tag.";
    return;
  }

  try {
    const key = deriveKey(passphrase);
    const record = people[id];
    const decryptedJSON = decryptRecord(record.encrypted, record.iv, key);

    if (!decryptedJSON) throw new Error("Decryption failed");

    const data = JSON.parse(decryptedJSON);

    document.getElementById("info").classList.remove("hidden");
    document.getElementById("name").textContent = data.name;
    document.getElementById("nationality").textContent = data.nationality;
    document.getElementById("allergies").textContent = data.allergies;
    document.getElementById("medical").textContent = data.medical;
    document.getElementById("medications").textContent = data.medications;
    document.getElementById("blood").textContent = data.blood;
    document.getElementById("contact").textContent = data.contact;
    document.getElementById("contact2").textContent = data.contact2;
    document.getElementById("languages").textContent = data.languages;

    error.textContent = "";
  } catch (e) {
    console.error(e);
    error.textContent = "Incorrect passphrase or decryption error.";
  }
}

window.addEventListener("load", () => {
  const field = document.getElementById("passphrase");
  field.focus();
  field.addEventListener("keydown", e => { if(e.key==="Enter") unlock(); });
});
</script>
</body>
</html>
