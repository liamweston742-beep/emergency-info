<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Emergency Information</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

<style>
  body {
    font-family: 'Roboto', Arial, sans-serif;
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    background: linear-gradient(135deg, #e0e5ec, #f5f7fa);
    min-height: 100vh;
  }

  .container {
    background: #fff;
    width: 95%;
    max-width: 600px; /* widened from 480px */
    padding: 30px;
    border-radius: 16px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    border: 1px solid #d1d5db;
    word-wrap: break-word; /* ensures long text wraps */
}


  h1 { text-align: center; color: #b30000; margin-bottom: 5px; }
  .subtitle { text-align: center; color: #555; font-size: 0.9em; margin-bottom: 20px; }

  .input-wrapper {
    position: relative;
    width: 100%;
    margin-top: 10px;
  }

  .input-wrapper input {
    width: 100%;
    padding: 14px;
    padding-right: 50px;
    font-size: 1em;
    border-radius: 8px;
    border: 1px solid #b0b5bf;
    box-sizing: border-box;
    transition: border-color 0.3s, box-shadow 0.3s;
  }

  .input-wrapper input:focus {
    outline: none;
    border-color: #0052cc;
    box-shadow: 0 0 5px rgba(0,82,204,0.3);
  }

  .input-wrapper .show-hide {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    border: none;
    background: none;
    cursor: pointer;
    font-size: 1.1em;
    color: #555;
  }

  .input-wrapper .show-hide:hover { color: #000; }

  #unlockBtn {
    background-color: #b30000;
    color: white;
    margin-top: 15px;
    font-weight: 600;
    border-radius: 8px;
    border: none;
    padding: 14px;
    font-size: 1.05em;
    cursor: pointer;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
  }

  #unlockBtn:hover {
    background-color: #900000;
    box-shadow: 0 6px 12px rgba(0,0,0,0.15);
  }

  #error { color: #d93025; margin-top: 10px; font-weight: bold; text-align: center; }

  .card {
    background: #f9f9f9;
    padding: 20px;
    margin-top: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  }

  .card p { margin: 8px 0; line-height: 1.4; }
  .card strong { display: inline-block; width: 140px; }
  .hidden { display: none; }
</style>
</head>

<body>
<div class="container">
  <h1>Emergency Information</h1>
  <p class="subtitle">Authorised access only</p>

  <div class="input-wrapper">
    <input type="password" id="passphrase" placeholder="Enter passphrase">
    <button type="button" class="show-hide" onclick="togglePassphrase()">üëÅ</button>
  </div>

  <button id="unlockBtn" onclick="unlock()">Unlock</button>
  <p id="error"></p>

  <div id="info" class="hidden card">
    <p><strong>Name:</strong> <span id="name"></span></p>
    <p><strong>Nationality:</strong> <span id="nationality"></span></p>
    <p><strong>Allergies:</strong> <span id="allergies"></span></p>
    <p><strong>Medical Conditions:</strong> <span id="medical"></span></p>
    <p><strong>Medications:</strong> <span id="medications"></span></p>
    <p><strong>Blood Type:</strong> <span id="blood"></span></p>
    <p><strong>Emergency Contact 1:</strong> <span id="contact"></span></p>
    <p><strong>Emergency Contact 2:</strong> <span id="contact2"></span></p>
    <p><strong>Languages:</strong> <span id="languages"></span></p>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<script>
// All your encrypted records
const encryptedArray = [
[
  {
    "id": "a1b2c3d4",
    "iv": "d1f2a176e5b1c899e3bf083e37cf7fae",
    "encryptedData": "8a9754f8c119b4507db9b2170d60225fe2d1cb929b3b27e00fb866ad8d4ca13e30dadcbfc8192cecbcd7423b56f96f32a5a63799e2f7c99f354ae052251a914d2a6b35e17754818f6e11e6f3af9a0d01642e25264465e17c8214cee63d28ae753c33ad2a4d19cafd4dc2c284d9b3fd0d95c2420ef5cc354adcbf66f9f8290f5393bb395e4e98b10fcd037f7c86c8522a5f8861d81da83f93b764a2917b659c088cf986e4fd02498c02817e04a7b21ce56e5367b5a389008522931cf3e015fcb650ace66e9e35f12e45a85aa52dee086593d741cd08769949bb837d11e69fd61a9d531584125c6f433179e6ac974234a0f3a15969dcdcf89c6f85ba6e0e38d28c36149345080236ede1c1cd8ae3b9005de4c3afa563e9b3805322de5e96c39ee4"
  },
  {
    "id": "e5f6g7h8",
    "iv": "67583d333d6f8ed8793577826fd0bd59",
    "encryptedData": "1c373a92a2d8ef3ac8dbc1c562ecbebab5b35b129e13504551822518ab1f10bfd6017a778d3e270c748e6253fc72205d146c714e3ff3beaeb9425c1e25433c3e4268ff454951f0338af717bc0417f9e6f8f7ff59999b3ff98aede7479082bb08c77a38f26364ed1845f279dc7015416657907c41b292a0abc7f8d8d84c19191c061e06ff90f18b8e1601f42655e84bde0775d901658eb5a522fe358dc51ec0328264aa9a17cff66f4f58e347ae2838781fc3dc0dac151fbbf615180f524ec001fa7ebab20999d3bd9cacace8a3e26df8048cca3806e3f57a02f536e513b30222f193dcaf33b1b738dd061c93837902b1d064b847c30b5b81c66e7a5ce1c7f3cb6f3796dea14a898ee55b9d348fd488d868a2782da79c9ec09c5db8658d171293330e0131002feb356b2f4b9727f909e6"
  },
  {
    "id": "i9j0k1l2",
    "iv": "b965dc37c75aac6685020be8dba95516",
    "encryptedData": "e8c67eae91beb9ce981bccbeaed93ed89ccc4503850298add5ef550f010f3f376d91e87da525a44b474174cfacd4b638d9267f5f46aa7a4b9f8f8e2f596af17e4654e5688ff687e617689f024c8360b3c5227ac41f2c24b547736230a065005121e668e696bd3c5844fd4adf05812a8198548f11f49e08a31ccea64b613de2be3101fed4e13e764d293bc8ad13a6f9782ae90b9eb0315d4805d9e8642a91eb5f3d2afd99a077c321f1dc28b8d52a0b6c0dcd5f6f08fcfd86b43a7704d08798840317dd2a53670e97d659d96c2f266da04fe79a0bdc868c4bfc264f5318658922fb0199a8baf95b9a71e5f8688e4c7be6a694abb2d0cf627c87b217eaad98f7ec626990edb39d77a1bc574598f888be5c95ecbd890c8211d32f6e08016991f6bf19ffee1300f509da1abf35a6894b97f7"
  },
  {
    "id": "m3n4o5p6",
    "iv": "de439730d0d1ff15e3b7d854761f73e4",
    "encryptedData": "a3bf417b45d59df81cc6dae0df9e0e3c4f3bc147d0b3b21ac73c0c913bd0e3e4ef006200b0f617d9c3cfbdb0c195b2b19d3b316a804f2d470dec0953a38d07af5365265a7d9599bc2acb2109c66ed485ab443d75fa1c5947454d19812248b451ad24c1a02a5b018cb8a6c6af81ecf0bd416194feb4ca01e6cbeed6b21085052b78b8ad07ac324a85ad293afc4a6f3e94f1e2c30acb4ae6156ed8fc712b31ea776eddb3ceee6b8aed3e1e370665ca4c59c265c4cf5d007d1ef389b5e15479dc2ca0597b1b7663a29e98a6c5105909519aa71dec6788a7c2e4f8f6aa24bd92812663ba5d63a0431809ba9f85609374ef905c3d2fcf3968ea2e194df593fff6dafceb039fa7c86766662a5b1ada4da02307"
  },
  {
    "id": "q7r8s9t0",
    "iv": "10085c6825614518acdef8f99230d167",
    "encryptedData": "168f6b821a8ebee5b82750c85f2efb8cf2571065ce61d0fcdf4e0169efc0b40348026dfdfe6dfbb6c21896ecf680593900262b8c9f96fba030802ea770ac632f3ee6de62719ef0539356fadbb8f36d5979a22f4175571960de6e7c24e6526f886c8e58374f1466784655f456de42e4d3db655aeb21de84bccd9d622eaf95803b2f09d35b0c964574678a524677f9399eb97c7c2411b0549161fa6fc8b3a351d53ea9dbacbb1213d8292e2e1769ed1b9300a0211f439a5c0f71562d524933d92b0a6cd808ce8655eeedb4f1079f93f1b892186bae469bb236eb304d482586e891bf022381c21d6545eb94256f3ed0afda3cb4e55e753c72e8dc26c7c375fb093356e7106660fd78abbcd8f58f26eb745b83209a9035665fca6182dfebee7c2512"
  },
  {
    "id": "u1v2w3x4",
    "iv": "6397df827aee7b27da59fbaaa0f5ce0e",
    "encryptedData": "c36ef4de07c0a09f7bc8540fc4183524c22cc58cf1c6f15077c023b078a7cb10e2c2439d9565412307bd8488c98a425d88c9e45df6b57705b4dff497356534fc6beb644ccabe748b628e29036cb71d08b6034796d2cb1540b7bf05829a880cd9667211899d2864692a9b2f19de59b5200b927b007432c29e7c80fc7b1137b42843eda6daf0e5e7c20500e440f78082afd80d9e73fa66d8c59db356ec64bb0c3e211a3f9661d201137192deec8ddade72a2ec54adf17eb7f315b3704e3e4c80b3260cc718d717eb93107495432415821be5e9f553485d5d242b0e51a4129d9276591fffa7e8c7b7d68cd6d249378ec6eb80ce3ef80b5886ab189500ffee0afb2faee3b1fd67f37aee6659f0f00dab50f8cefc5a06cf09949874c281aa5ab73372"
  },
  {
    "id": "y5z6a7b8",
    "iv": "47ca1c0acc5814bf649bd15b595ca6ec",
    "encryptedData": "3da3790a93e85e2e81eb74b785243b7405ea0df4d0b9b166badd28b32eec1699c8d441550e708a8cd1fa3fbd425f04c3f31f57c65c1b5707951ec02a6185f3e4bf649f17c2b5ad70e8a81e5ee03960464ec68b3505bb7ed759625acf38ea2efcd0ebae57be61c260971b92a2f52220e7dcd625cc2e695f43ab2d823e6c2f89a9d1fbacd352bc9441dcdec8a33288919fe4f0d3426a1b49a4644b67f7e0ef02059c9118ad70a885d15b35a3f17d67c368011e21924291cdd2740ccf6acbdf2178e934225b3a7cf77edf75c155f0b19e026814bdff3504f22c0de2970948906ee2db698b695e81be878930953f45d1bb9dc0ccb5e6196d400a41f238a14b009c64c803292ee33f10e1698895b3625ef211ea5fa160542394e8526043f6ef00450b5c05bc4208a8ae17887eab0ed773620f"
  },
  {
    "id": "c9d0e1f2",
    "iv": "3719bb8f3534101facb59cf831ba6093",
    "encryptedData": "328545f86a89ec657f22e876c1792906c2e912073fa0089058ed9cc245f683ecfacd9d51a597c444015b4d3ba8922c04429255e5a148274ec0ca8354b5cfeae4b76cf24d8b7431794cb0af239edd1d1dc5a9ce1a3f823beb466c3b1617312360492fd4bf3c2fb995ab8eef7f76c8de0350cd99455b43d3daca8a6453f12229eab57498eba1dcaa2269779d3590fcc528d736686a0f6cda6795fb9f9586e91ed4e28ee03cc83672a19ba26a753706a4739a7d35984e6b9e443a0a896b7faf8b736c914b535fa6199ad80c08797f20979d42216f11a7b9332d9e052ac9a0c2929d5a3d7c48c51192fd95bb3e03da5b8a0692d4df0164be52f34063354e77d28db6c225d782585dd58d223cc5a4ac30e331cfbddd0111d078e80a6290c867534477c13256463c4dd2eb1c104bb32b072e00689ebff504cc87933b19e1a4ca4dd14740427d67382394c327c45c7539c3f977"
  },
  {
    "id": "g3h4i5j6",
    "iv": "5299928cd8af5a38f76b0eaad1940a59",
    "encryptedData": "59e45c80bf40910a7186e06deeba53b6d3f07191282bdf57ed5ccd9ebc483b9857eb5c738496ad30c7dcd9c054c5d89062cf378f6e4cef32d452ea17bdd0e2221f4d367398712a3a16c5a467fb27a5410f81983292024afca511d680aaea2c7818cd07888db2a6a28c8dbe725003dc1f3adc2fc40cd3a0bb3280bb92f3a3c580f443bd8253887fde20f79bfe6fee75d9eb395117111615fe75ad8dfaba1940b2b0b0f31e1c51f86a50e0f309388923d9f552ad59bed13e6a5379f4e33ad8a002ac4e999c6425b5501395f9059059c76b5192227f6d551b8473688424150d6fa4bb3a60dd587321e9f8ef51832d3fe8061f7522648dd65cf3c70d82d0fbad3af286aa470dd536d8513567b61dd6ab0216b626f7b9c58df8be8fdbf98000834466"
  },
  {
    "id": "k7l8m9n0",
    "iv": "bbafb434d0b544a99f318b19425344ea",
    "encryptedData": "50e8e35a861c34da0593701844f25c9ea3832f839e7a66859201fbfe31ccd9b7bb384abc92a456bc51cd3359e5bba03a5aa14751ed0002ab352a5a91896acc7667bb5e453a4dc1e48c0d12e5bed281a0028efc707f0ead7f758ccdfbf5913c144d28bac7d2f71b6940e879450fbd346762b75efa422aec8efb3ac67c55ba7cd8a2bab6a3e2ce93cb3d54ceb9932745cf253ea75c15351db42d04cfce8b7497aaabffb3a35dc03bfeeaa88a23afceaf33e7028de5f36e6149fa8939a0681f132811c5b3fd8ed668a2caac17043c6cd794c5871da48becd86ee4ab5b23de9ec0ffa5fa043ba521bea57c396b1450885ce7f7b9159f5b5bd2e03747c82f2b45b747bc3d8fd79eb3218bb8c651a0d36378bd9038f93bb0bebb80ea9feabc4d324344"
  },
  {
    "id": "o1p2q3r4",
    "iv": "1b24a82a738c6c1089fe5852782df4f0",
    "encryptedData": "bdea85fdc1d7e65671e4d20e225d2ce8de7ecee441cf9c2427d9f14f9fbce8bed20e73f279c9f9522bc6be8aa789c8e936b377d0945180cba8bdfbc40c33429644f86bb7799d0e5fc15dc3c140a655ba9cc51617a680ae5b394bb5274d16d377fdc894fcb445ddf716e1e3fdb5ec1eac5bccf1d2d1f7a143480e780ea3c9c458d6a5a1644fa024fa9853d9dc317c97b110fe33a39fc3c4bcb2c8f788af562d577d21094a84a6b6ecff6665dc6158d091c4c3a243ac09ea74cc0805f0fdcc1fbf30596cabe8acb912c49d220d0c5b3bf89e67b052ca160398c3eeb74bf46b63d1edf1da214de66169eae311efd2c983d7883edab0779b1e39f7eb90eea864eb6e796d208f79859f856d604c2cdda365dd0573aeae6679ee7266bf44c07ffdb2a1"
  },
  {
    "id": "s5t6u7v8",
    "iv": "655e1879e0937c839d5a77d982a90ab0",
    "encryptedData": "d80aea67095c3f1bcc9306ede70d1e6b6cfd3ec3ef5e2915cde76d0a4fb5c3c55828f1fd49bbda9ef3184584f7fbcb7394810037d37905a0944d79e28480b1674c8334631f01293ca163822d2df712b8b644fd6f67e3bea989a4be37e4d4ce827df4b588a0ca81aabd65725792e32f33d639e3fcaabbc4c0905e9df4aae9bd71faf38d0ebfd6f549ebd120b677a01745dcb23a7b5dafb3dc80f029a10853bd06afa65667bde3a16137af673f4e2617f37c677097666d302084eb6e3ad67cb93230b9cc00364d56acae43dfae781909b39d245a9844f4623f31a810015e6fc66053a0b9333e924bb31caebe7fc7c5d839616dca1eae22d58c85548970a8e17520fb70a7eab46216985ac571c4e0ad9ddf06618b2fa612ce67787bcc4dfcd1cacb"
  }
]

];


// Convert array to object correctly
const people = {};
encryptedArray[0].forEach(record => {
  people[record.id.toLowerCase()] = { encrypted: record.encryptedData, iv: record.iv };
});


// Get ID from URL
const params = new URLSearchParams(window.location.search);
const id = params.get("id")?.toLowerCase();

function togglePassphrase() {
  const input = document.getElementById("passphrase");
  input.type = input.type === "password" ? "text" : "password";
}

function deriveKey(passphrase) {
  return CryptoJS.SHA256(passphrase);
}

function decryptRecord(encryptedHex, ivHex, key) {
  const encryptedWords = CryptoJS.enc.Hex.parse(encryptedHex);
  const ivWords = CryptoJS.enc.Hex.parse(ivHex);
  const decrypted = CryptoJS.AES.decrypt(
    { ciphertext: encryptedWords },
    key,
    { iv: ivWords, mode: CryptoJS.mode.CBC, padding: CryptoJS.pad.Pkcs7 }
  );
  return decrypted.toString(CryptoJS.enc.Utf8);
}

function unlock() {
  const passphrase = document.getElementById("passphrase").value.trim();
  const error = document.getElementById("error");

  if (!passphrase) {
    error.textContent = "Enter a passphrase.";
    return;
  }

  if (!id || !people[id]) {
    error.textContent = "Invalid emergency tag.";
    return;
  }

  try {
    const key = deriveKey(passphrase);
    const record = people[id];
    const decryptedJSON = decryptRecord(record.encrypted, record.iv, key);

    if (!decryptedJSON) throw new Error("Decryption failed");

    const data = JSON.parse(decryptedJSON);

    document.getElementById("info").classList.remove("hidden");
    document.getElementById("name").textContent = data.name;
    document.getElementById("nationality").textContent = data.nationality;
    document.getElementById("allergies").textContent = data.allergies;
    document.getElementById("medical").textContent = data.medical;
    document.getElementById("medications").textContent = data.medications;
    document.getElementById("blood").textContent = data.blood;
    document.getElementById("contact").textContent = data.contact;
    document.getElementById("contact2").textContent = data.contact2;
    document.getElementById("languages").textContent = data.languages;

    error.textContent = "";
  } catch (e) {
    console.error(e);
    error.textContent = "Incorrect passphrase or decryption error.";
  }
}

window.addEventListener("load", () => {
  const field = document.getElementById("passphrase");
  field.focus();
  field.addEventListener("keydown", e => { if(e.key==="Enter") unlock(); });
});
</script>
</body>
</html>
